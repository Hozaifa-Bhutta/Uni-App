{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createDevServerMiddleware = createDevServerMiddleware;\nObject.defineProperty(exports, \"devToolsMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _devToolsMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"indexPageMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _indexPageMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"openStackFrameInEditorMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _openStackFrameInEditorMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"openURLMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _openURLMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"rawBodyMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _rawBodyMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"securityHeadersMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _securityHeadersMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"statusPageMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _statusPageMiddleware.default;\n  }\n});\nObject.defineProperty(exports, \"systraceProfileMiddleware\", {\n  enumerable: true,\n  get: function get() {\n    return _systraceProfileMiddleware.default;\n  }\n});\n\nfunction _compression() {\n  var data = _interopRequireDefault(require(\"compression\"));\n\n  _compression = function _compression() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _connect() {\n  var data = _interopRequireDefault(require(\"connect\"));\n\n  _connect = function _connect() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _errorhandler() {\n  var data = _interopRequireDefault(require(\"errorhandler\"));\n\n  _errorhandler = function _errorhandler() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _nocache() {\n  var data = _interopRequireDefault(require(\"nocache\"));\n\n  _nocache = function _nocache() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _serveStatic() {\n  var data = _interopRequireDefault(require(\"serve-static\"));\n\n  _serveStatic = function _serveStatic() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _cliDebuggerUi() {\n  var data = require(\"@react-native-community/cli-debugger-ui\");\n\n  _cliDebuggerUi = function _cliDebuggerUi() {\n    return data;\n  };\n\n  return data;\n}\n\nvar _devToolsMiddleware = _interopRequireDefault(require(\"./devToolsMiddleware\"));\n\nvar _indexPageMiddleware = _interopRequireDefault(require(\"./indexPageMiddleware\"));\n\nvar _openStackFrameInEditorMiddleware = _interopRequireDefault(require(\"./openStackFrameInEditorMiddleware\"));\n\nvar _openURLMiddleware = _interopRequireDefault(require(\"./openURLMiddleware\"));\n\nvar _rawBodyMiddleware = _interopRequireDefault(require(\"./rawBodyMiddleware\"));\n\nvar _securityHeadersMiddleware = _interopRequireDefault(require(\"./securityHeadersMiddleware\"));\n\nvar _statusPageMiddleware = _interopRequireDefault(require(\"./statusPageMiddleware\"));\n\nvar _systraceProfileMiddleware = _interopRequireDefault(require(\"./systraceProfileMiddleware\"));\n\nvar _createDebuggerProxyEndpoint = _interopRequireDefault(require(\"./websocket/createDebuggerProxyEndpoint\"));\n\nvar _createMessageSocketEndpoint = _interopRequireDefault(require(\"./websocket/createMessageSocketEndpoint\"));\n\nvar _createEventsSocketEndpoint = _interopRequireDefault(require(\"./websocket/createEventsSocketEndpoint\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction createDevServerMiddleware(options) {\n  var debuggerProxyEndpoint = (0, _createDebuggerProxyEndpoint.default)();\n  var isDebuggerConnected = debuggerProxyEndpoint.isDebuggerConnected;\n  var messageSocketEndpoint = (0, _createMessageSocketEndpoint.default)();\n  var broadcast = messageSocketEndpoint.broadcast;\n  var eventsSocketEndpoint = (0, _createEventsSocketEndpoint.default)(broadcast);\n  var middleware = (0, _connect().default)().use(_securityHeadersMiddleware.default).use((0, _compression().default)()).use((0, _nocache().default)()).use('/debugger-ui', (0, _cliDebuggerUi().debuggerUIMiddleware)()).use('/launch-js-devtools', (0, _devToolsMiddleware.default)(options, isDebuggerConnected)).use('/open-stack-frame', (0, _openStackFrameInEditorMiddleware.default)(options)).use('/open-url', _openURLMiddleware.default).use('/status', _statusPageMiddleware.default).use('/symbolicate', _rawBodyMiddleware.default).use('/systrace', _systraceProfileMiddleware.default).use('/reload', function (_req, res) {\n    broadcast('reload');\n    res.end('OK');\n  }).use((0, _errorhandler().default)());\n  options.watchFolders.forEach(function (folder) {\n    middleware.use((0, _serveStatic().default)(folder));\n  });\n  return {\n    websocketEndpoints: {\n      '/debugger-proxy': debuggerProxyEndpoint.server,\n      '/message': messageSocketEndpoint.server,\n      '/events': eventsSocketEndpoint.server\n    },\n    debuggerProxyEndpoint: debuggerProxyEndpoint,\n    messageSocketEndpoint: messageSocketEndpoint,\n    eventsSocketEndpoint: eventsSocketEndpoint,\n    middleware: middleware\n  };\n}","map":{"version":3,"sources":["../src/index.ts"],"names":["debuggerProxyEndpoint","isDebuggerConnected","messageSocketEndpoint","broadcast","eventsSocketEndpoint","middleware","securityHeadersMiddleware","openURLMiddleware","statusPageMiddleware","rawBodyMiddleware","systraceProfileMiddleware","res","options","folder","websocketEndpoints","server"],"mappings":"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","sourcesContent":["import http from 'http';\n\nimport compression from 'compression';\nimport connect from 'connect';\nimport errorhandler from 'errorhandler';\nimport nocache from 'nocache';\nimport serveStatic from 'serve-static';\nimport {debuggerUIMiddleware} from '@react-native-community/cli-debugger-ui';\n\nimport devToolsMiddleware from './devToolsMiddleware';\nimport indexPageMiddleware from './indexPageMiddleware';\nimport openStackFrameInEditorMiddleware from './openStackFrameInEditorMiddleware';\nimport openURLMiddleware from './openURLMiddleware';\nimport rawBodyMiddleware from './rawBodyMiddleware';\nimport securityHeadersMiddleware from './securityHeadersMiddleware';\nimport statusPageMiddleware from './statusPageMiddleware';\nimport systraceProfileMiddleware from './systraceProfileMiddleware';\n\nimport createDebuggerProxyEndpoint from './websocket/createDebuggerProxyEndpoint';\nimport createMessageSocketEndpoint from './websocket/createMessageSocketEndpoint';\nimport createEventsSocketEndpoint from './websocket/createEventsSocketEndpoint';\n\nexport {devToolsMiddleware};\nexport {indexPageMiddleware};\nexport {openStackFrameInEditorMiddleware};\nexport {openURLMiddleware};\nexport {rawBodyMiddleware};\nexport {securityHeadersMiddleware};\nexport {statusPageMiddleware};\nexport {systraceProfileMiddleware};\n\ntype MiddlewareOptions = {\n  host?: string;\n  watchFolders: ReadonlyArray<string>;\n  port: number;\n};\n\nexport function createDevServerMiddleware(options: MiddlewareOptions) {\n  const debuggerProxyEndpoint = createDebuggerProxyEndpoint();\n  const isDebuggerConnected = debuggerProxyEndpoint.isDebuggerConnected;\n\n  const messageSocketEndpoint = createMessageSocketEndpoint();\n  const broadcast = messageSocketEndpoint.broadcast;\n\n  const eventsSocketEndpoint = createEventsSocketEndpoint(broadcast);\n\n  const middleware = connect()\n    .use(securityHeadersMiddleware)\n    // @ts-ignore compression and connect types mismatch\n    .use(compression())\n    .use(nocache())\n    .use('/debugger-ui', debuggerUIMiddleware())\n    .use(\n      '/launch-js-devtools',\n      devToolsMiddleware(options, isDebuggerConnected),\n    )\n    .use('/open-stack-frame', openStackFrameInEditorMiddleware(options))\n    .use('/open-url', openURLMiddleware)\n    .use('/status', statusPageMiddleware)\n    .use('/symbolicate', rawBodyMiddleware)\n    .use('/systrace', systraceProfileMiddleware)\n    .use('/reload', (_req: http.IncomingMessage, res: http.ServerResponse) => {\n      broadcast('reload');\n      res.end('OK');\n    })\n    .use(errorhandler());\n\n  options.watchFolders.forEach((folder) => {\n    // @ts-ignore mismatch between express and connect middleware types\n    middleware.use(serveStatic(folder));\n  });\n\n  return {\n    websocketEndpoints: {\n      '/debugger-proxy': debuggerProxyEndpoint.server,\n      '/message': messageSocketEndpoint.server,\n      '/events': eventsSocketEndpoint.server,\n    },\n    debuggerProxyEndpoint,\n    messageSocketEndpoint,\n    eventsSocketEndpoint,\n    middleware,\n  };\n}\n"]},"metadata":{},"sourceType":"script"}